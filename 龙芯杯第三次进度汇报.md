# 龙芯杯第三次进度汇报

汇报人：闻人雨泽

### 进度总览：

1. 完成不考虑冲突的五级流水线设计（EXP7）
1. 配置完成soc_simulator
1. 完成阻塞解决写后读冲突（EXP8）
1. 完成前递解决写后读冲突（EXP9）
1. 完成更多指令支持（EXP10）

### EXP7

debug过程中遇到的比较耗时的问题：

1. 开始在遇到跳转指令时，发现我的pc总是下一个clock会先+4，再下一个clock才跳转，导致波形比对Error。

   但在我和冯松权仔细模拟了一整遍信号变化过程之后发现，得到这样的结果是符合预期的，不考虑冲突的五级流水线就是无法正确处理跳转指令的，是我的goldentrace出错了。😄

2. 陆续debug了几种指令后，卡在了一个ld.w指令，怎么都看不出来哪里错了。

   用vivado把顶层的data_sram_en，data_sram_addr，data_sram_rdata拉出来之后发现，data_sram_en和data_sram_addr都是正确的，但是data_sram_rdata不对。自然而然地开始怀疑自己地IP核没有配置好，但是无论是重新配置IP核，重新make func，重新用`create_project.tcl`生成vivado工程，都没有解决这个问题。

   而后重新阅读第五章任务要求，发现了这句话：“调整CPU顶层接口，将inst_sram_we 和 data_sram_we 都从1比特的写使能调整为4比特的**字节写使能**。”，然后联想到我的data_rdata的最后1个字节的值是对的，发现是自己的data_sram_we出错了，在st.w指令写回的时候只赋值为了1，而不是F，导致st.w指令实现出错，进而使得ld.w指令读取不到正确的结果。

### EXP8

写的时候倒没有遇到特别的问题，但是在想优化一下data_sram_en信号的时候遇到了很搞的问题。

本来的内存读使能一直是true，现在改成了只有需要访存（也就是ld_w）的时候赋true，但是突然就不能通过测试了。

搞了半天最后发现是写入内存的时候也需要将内存读使能信号赋true，也就是st_w时读使能也要出1。

真是神神又奇奇啊。

### EXP9

没有什么问题

### EXP10

本来想使用像PUA-MIPS一样的config，但是搞了半天一直没通过编译，最后还是把config的设置搞成了全局的一个常量。

目前的乘除法还是一个周期的，没有添加握手信号。